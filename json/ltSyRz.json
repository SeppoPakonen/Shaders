{"ver":"0.1","info":{"id":"ltSyRz","date":"1507394105","viewed":141,"name":"Mouse Reveal","username":"tCole","description":"This shader demonstrates a set of image convolutions. The top image has a parametrically modifiable blur filter. The image revealed by the mouse shows a different convolution that can be switched via variable.","likes":2,"published":1,"flags":0,"tags":[]},"renderpass":[{"inputs":[{"id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","previewfilepath":"/media/ap/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","previewfilepath":"/media/ap/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float revealPercent = 0.1; // the size of the reveal circle\nint blurIntensity = 4; \t\t// how blurry the top image is\nint revealKernel = 0; \t\t// which kernel will be used on the revealed image\n\t\t\t\t\t\t\t// (0 = sharpen, 1 = emboss, 2 = edge detect, 3 = directional blur, 4 = identity)\n\n// sharpen kernel\nmat3 sharpen = mat3(\n 0., -1, 0.0, // first column (not row!)\n -1, 5, -1, // second column\n 0., -1, 0.0 // third column\n);\n\n// emboss kernel\nmat3 emboss = mat3(\n -2.0, -1.0, 0.0, // first column (not row!)\n -1.0, 1.0, 1.0, // second column\n 0.0, 1.0, 2.0 // third column\n);\n\n// edge detect kernel\nmat3 edgeDetect = mat3(\n 0.0, -1.0, 0.0, // first column (not row!)\n -1.0, 4.0, -1.0, // second column\n 0.0, -1.0, 0.0 // third column\n);\n\n// directional blur kernel\nmat3 directionalBlur = mat3(\n 0.0, 0.075, 0.23, // first column (not row!)\n 0.075, 0.23, 0.075, // second column\n 0.23, 0.075, 0.0 // third column\n);\n\n// identity kernel\nmat3 identity = mat3(\n 0.0, 0.0, 0.0, // first column (not row!)\n 0.0, 1.0, 0.0, // second column\n 0.0, 0.0, 0.0 // third column\n);\n\n// sample a pixel relative to a given pixel\nvec3 aSample(const int x, const int y, in vec2 fragCoord, int channel)\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy * iChannelResolution[0].xy;\n\tuv = (uv + vec2(x, y)) / iChannelResolution[0].xy ;\n    \n    vec3 zero = texture(iChannel0, uv).xyz;\n    vec3 one = texture(iChannel1, uv).xyz;\n\n    return mix(zero, one, float(channel));\n}\n\n// apply a kernel convolution to a pixel\nvec3 aKernelFilter(in vec2 fragCoord, mat3 kernel, int channel)\n{\n    vec3 sum = vec3(0.0, 0.0, 0.0);\n    int j;\n    \n    for(int i = 0; i < 3; i++)\n    {\n        for(j = 0; j < 3; j++)\n        {\n        \tsum += aSample(i - 1, j -1, fragCoord, channel) * kernel[i][j];\n        }\n    }\n \n\treturn sum;\n}\n\n// apply a blur convolution to a pixel\nvec3 aBlurFilter(in vec2 fragCoord, int channel, int intensity)\n{\n    // Since every value in a box blur kernel is the same, we can\n    // apply the filter with a single float rather than a whole matrix.\n    float percent = 1.0 / float(intensity * intensity);\n    \n    vec3 sum = vec3(0.0, 0.0, 0.0);\n    int j;\n    \n    for(int i = 0; i < intensity; i++)\n    {\n        for(j = 0; j < intensity; j++)\n        {\n        \tsum += aSample(i - (intensity/2), j - (intensity/2), fragCoord, channel) * percent;\n        }\n    }\n \n\treturn sum;\n    \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // define the uv range\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    // define the reveal radius\n    float radius;\n    float area = iResolution.x * iResolution.y;\n    area *= revealPercent;\n    radius = float(area) / 3.14;\n    radius = sqrt(radius);\n    \n    // filter the two texture samples\n    vec4 reg = vec4(aBlurFilter(fragCoord.xy, 1, blurIntensity), 1.0);\n    vec4 hidden;\n    \n    switch (revealKernel){\n        case 0:\n        \thidden = vec4(aKernelFilter(fragCoord.xy, sharpen, 0), 0.0);\n    \t\tbreak;\n    \tcase 1:\n    \t\thidden = vec4(aKernelFilter(fragCoord.xy, emboss, 0), 0.0);\n    \t\tbreak;\n    \tcase 2:\n    \t\thidden = vec4(aKernelFilter(fragCoord.xy, edgeDetect, 0), 0.0);\n    \t\tbreak;\n        case 3:\n    \t\thidden = vec4(aKernelFilter(fragCoord.xy, directionalBlur, 0), 0.0);\n    \t\tbreak;\n        case 4:\n    \t\thidden = vec4(aKernelFilter(fragCoord.xy, identity, 0), 0.0);\n    \t\tbreak;\n    }\n    \n    // mix the two textures with the alpha channel\n    hidden.a += step(length(fragCoord - iMouse.xy), radius);\n    reg = mix(reg, hidden, hidden.a);\n        \n    fragColor = reg;\n}","name":"Image","description":"","type":"image"}]}