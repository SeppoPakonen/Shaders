{"ver":"0.1","info":{"id":"WslGDX","date":"1547662661","viewed":381,"name":"Shallow Water Simulation","username":"mackycheese21","description":"I got a copy of \"Fluid Simulation for Computer Graphics, 2nd Edition\" by Robert Bridson.  AWESOME book!  This is not an ad.  You should really check it out.  This is Chapter 12 of that book.","likes":9,"published":1,"flags":32,"tags":[]},"renderpass":[{"inputs":[{"id":"XsX3zn","filepath":"/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","previewfilepath":"/media/ap/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","type":"cubemap","channel":1,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define get(x,y) texture(iChannel0,(fragCoord+vec2(x,y))/iResolution.xy)\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n    \n    vec4 xmi=get(-1,0);\n    vec4 xpl=get(1,0);\n    vec4 ymi=get(0,-1);\n    vec4 ypl=get(0,1);\n    \n    float dx=xpl.z-xmi.z;\n    float dy=ypl.z-ymi.z;\n    float z=0.01;\n    \n    vec3 n=normalize(vec3(dx,dy,z));\n\n//    fragColor=texture(iChannel0,uv).zzzz*20.0;\n//    fragColor=vec4(0.5+0.5*n,1.0);\n//    fragColor=texture(iChannel0,uv);\n//    n=n.xzy;\n    fragColor=texture(iChannel1,n);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"\nconst float gravity=40.0;\nconst float dt=0.5/sqrt(gravity*2.0);","name":"Common","description":"","type":"common"},{"inputs":[{"id":"XdfGR8","filepath":"/media/previz/buffer03.png","previewfilepath":"/media/previz/buffer03.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define maxVel 5.0\nfloat min2 (vec2 v) {\n  return min(v.x,v.y);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    if(iFrame<10){\n        fragColor=vec4(0.0,0.0,0.0,0.0);\n        return;\n    }\n    //advect\n    fragColor=texture(iChannel0,(fragCoord-texture(iChannel0,fragCoord/iResolution.xy).xy*dt)/iResolution.xy);\n    \n    vec2 diff=fragCoord-iMouse.xy;\n    float dist=30.0;\n    //if(iMouse.z>0.0&&  (diff.x>-dist&&diff.y>-dist&&diff.x<dist&&diff.y<dist)   ){\n    if(iMouse.z>0.0&&length(diff)<dist){\n        fragColor.z+=0.1;\n    }\n    if(iMouse.z>0.0){\n        //fixCells()\n        float vx=fragColor.x;\n        float vy=fragColor.y;\n        float l=sqrt(vx*vx+vy*vy);\n        if(l>maxVel){\n            fragColor.xy/=l;\n            fragColor.xy*=maxVel;\n        }\n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"#define get(x,y) texture(iChannel0,(fragCoord+vec2(x,y))/iResolution.xy).z\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    if(iFrame<10){\n        fragColor=texture(iChannel0,fragCoord/iResolution.xy);\n        return;\n    }\n    //pressure\n    /*\n    vec2 xmi=texture(iChannel0,(fragCoord-vec2(1.0,0.0))/iResolution.xy).xy;\n    vec2 xpl=texture(iChannel0,(fragCoord+vec2(1.0,0.0))/iResolution.xy).xy;\n    vec2 ymi=texture(iChannel0,(fragCoord-vec2(0.0,1.0))/iResolution.xy).xy;\n    vec2 ypl=texture(iChannel0,(fragCoord+vec2(0.0,1.0))/iResolution.xy).xy;\n    */\n    float dU=dt*gravity*(get(1,0)-get(-1,0))/2.0;\n    float dW=dt*gravity*(get(0,1)-get(0,-1))/2.0;\n    vec2 newVel=texture(iChannel0,fragCoord/iResolution.xy).xy-vec2(dU,dW);\n    fragColor = vec4(newVel,texture(iChannel0,fragCoord/iResolution.xy).z,1.0);\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    //pressure\n    \n    vec2 xmi=texture(iChannel0,(fragCoord-vec2(1.0,0.0))/iResolution.xy).xy;\n    vec2 xpl=texture(iChannel0,(fragCoord+vec2(1.0,0.0))/iResolution.xy).xy;\n    vec2 ymi=texture(iChannel0,(fragCoord-vec2(0.0,1.0))/iResolution.xy).xy;\n    vec2 ypl=texture(iChannel0,(fragCoord+vec2(0.0,1.0))/iResolution.xy).xy;\n    \n    float divX=(xpl.x-xmi.x)/2.0;\n    float divY=(ypl.y-ymi.y)/2.0;\n    \n    float newDens=texture(iChannel0,fragCoord/iResolution.xy).z;\n    newDens-=newDens*dt*(divX+divY);\n\n    fragColor = vec4(texture(iChannel0,fragCoord/iResolution.xy).xy,newDens,1.0);\n}","name":"Buffer C","description":"","type":"buffer"},{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XdfGR8","channel":0}],"code":"#define margin 3.0\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor=texture(iChannel0,fragCoord/iResolution.xy);\n    if(fragCoord.x<margin)fragColor.x=0.0;\n    if(fragCoord.y<margin)fragColor.y=0.0;\n    if(fragCoord.x>iResolution.x-margin)fragColor.x=0.0;\n    if(fragCoord.y>iResolution.y-margin)fragColor.y=0.0;\n}","name":"Buffer D","description":"","type":"buffer"}]}