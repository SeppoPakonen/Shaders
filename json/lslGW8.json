{"ver": "0.1", "info": {"id": "lslGW8", "date": "1369209778", "viewed": 1168, "name": "Bump mapping", "username": "Daniil", "description": "Use mouse to change light position.\niChannel0 is base input, Channel1 is bump texture.\nHeight of pixel is equal to brightness of Channel1 pixel.", "likes": 12, "published": 1, "flags": 0, "tags": ["bump", "mapping"], "requires": ["texture", "videobuf", "imagebuf", "texturebuf"]}, "renderpass": [{"inputs": [{"id": "4dX3Rn", "filepath": "/media/a/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg", "previewfilepath": "/media/ap/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg", "type": "texture", "channel": 1, "sampler": {"filter": "mipmap", "wrap": "repeat", "vflip": "false", "srgb": "false", "internal": "byte"}, "published": 1}, {"id": "4sX3Rn", "filepath": "/media/a/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv", "previewfilepath": "/media/ap/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv", "type": "video", "channel": 0, "sampler": {"filter": "linear", "wrap": "clamp", "vflip": "true", "srgb": "false", "internal": "byte"}, "published": 1}], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "float SPOT_SIZE = 300.0;\nfloat BUMP_STRENGTH = 2.0;\nfloat SPOT_BRIGHTNESS = 1.3;\n\nvec4 HEIGHT_VECTOR = vec4(1.0/3.0, 1.0/3.0, 1.0/3.0, 0.0);\n\nfloat getHeight(sampler2D channel, vec2 offset) {\n\treturn dot(texture(channel, offset / iResolution.xy), HEIGHT_VECTOR);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\t// get \"height\" of adjucent pixels based on their brightness\n\tfloat upHeight = getHeight(iChannel1, fragCoord.xy + vec2(0,-1));\n\tfloat bottomHeight = getHeight(iChannel1, fragCoord.xy + vec2(0,+1));\n\tfloat leftHeight = getHeight(iChannel1, fragCoord.xy + vec2(-1,0));\n\tfloat rightHeight = getHeight(iChannel1,fragCoord.xy + vec2(1,0));\n\t\n\t// calculate normal vector\n\tfloat dx = (rightHeight - leftHeight) * BUMP_STRENGTH;\n\tfloat dy = (bottomHeight - upHeight) * BUMP_STRENGTH;\n\tfloat dz = sqrt (1.0 - dx*dx - dy*dy);\t\n\tvec3 normal = vec3(dx,dy,dz);\n\t\n\t// get \"light\" vector based on mouse position\n\tvec2 mouse = iMouse.xy - fragCoord.xy;\n\t\n\t// dot product of normal and light\n\tfloat bumpMultiplier = dot(normal, vec3(mouse/iResolution.y,1.0));\n\t\n\t// spot light multiplier\n\tfloat spotMultiplier = min(exp(1.0-length(mouse)/SPOT_SIZE), SPOT_BRIGHTNESS);\n\t\n\t// output\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tvec4 color = texture(iChannel0, uv);\n\tfragColor = color * bumpMultiplier * spotMultiplier;\n\n}", "name": "Image", "description": "", "type": "image"}]}