{"ver":"0.1","info":{"id":"fsK3RD","date":"1631200117","viewed":146,"name":"Halo Music Visualizer","username":"Peace","description":"Visualizing something meant to be heard","likes":0,"published":3,"flags":0,"usePreview":0,"tags":[]},"renderpass":[{"inputs":[{"id":"4sXGzn","filepath":"/media/a/a6a1cf7a09adfed8c362492c88c30d74fb3d2f4f7ba180ba34b98556660fada1.mp3","previewfilepath":"/media/ap/a6a1cf7a09adfed8c362492c88c30d74fb3d2f4f7ba180ba34b98556660fada1.mp3","type":"music","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI 3.14159\n#define TWO_PI 6.28318\n#define FREQ 512.0\n\nvec3 rectangle(int x, int y, int width, int height, ivec2 fragCoord)\n{\n    if(fragCoord.x >= x && fragCoord.y >= y && fragCoord.x <= x + width && fragCoord.y <= y + height)\n        return vec3(1);\n    return vec3(0);\n}\n\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nfloat frequency(float x)\n{\n    return texture(iChannel0, vec2(x, 0)).r;\n}\n\nfloat wave(int x)\n{\n    return texelFetch(iChannel0, ivec2(x, 1), 0).r;\n}\n\nfloat smoothFrequency(float x, int smoothness)\n{\n    float f = 0.0;\n    int accumulated = 0;\n    for(float i = 0.0; i <= float(smoothness) / FREQ; i += 1.0 / FREQ)\n    {\n        f += frequency(x + i);\n        ++accumulated;\n    }\n    return f / float(accumulated);\n}\n\nfloat smoothWave(int x, int smoothness)\n{\n    float f = 0.0;\n    int accumulated = 0;\n    for(int i = 0; i <= smoothness; ++i)\n    {\n        if(x + i > int(FREQ) || x + i < 0) continue;\n        f += wave(x + i);\n        ++accumulated;\n    }\n    return f / float(accumulated);\n}\n \nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat luma(vec3 color) \n{\n  return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec2 uvn = (uv - 0.5) * 2.0;\n    uvn.x *= iResolution.x / iResolution.y;\n    \n    float f = FREQ / iResolution.x;\n    \n    vec3 col = vec3(0);\n  \n    float angle = atan(uvn.x, uvn.y);\n    float angleNormalized = angle / TWO_PI;\n    float b = 1.0;\n    vec3 halo = vec3(max(pow(1.0 - abs(length(uvn) - 0.6), 8.0), 0.0)) * b * 2.0;\n    halo = pow(halo, vec3(2.0));\n    vec3 halo2 = halo + vec3(max(pow(abs(length(uvn)), 4.0), 0.0)) * 0.25;\n    float freqColor = smoothFrequency(abs(angleNormalized), 16);\n    col = halo2 * hsv2rgb(vec3(angleNormalized - iTime * 0.2, 1.0, 1.0)) * freqColor;\n    \n    col = pow(col, vec3(2));\n    col += max(luma(col * 1.0) - 1.0, 0.0);\n    //col = sqrt(col);\n    \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}