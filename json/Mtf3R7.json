{"ver": "0.1", "info": {"id": "Mtf3R7", "date": "1419920060", "viewed": 2122, "name": "perlin noise smoke", "username": "jozxyqk", "description": "a very basic perlin noise turbulence to give a sort of smoke effect", "likes": 41, "published": 1, "flags": 0, "tags": ["smoke", "turbulence"], "requires": ["texture", "imagebuf", "texturebuf"]}, "renderpass": [{"inputs": [{"id": "XdfGRn", "filepath": "/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg", "previewfilepath": "/media/ap/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg", "type": "texture", "channel": 0, "sampler": {"filter": "mipmap", "wrap": "repeat", "vflip": "false", "srgb": "false", "internal": "byte"}, "published": 1}, {"id": "XdXGzn", "filepath": "/media/a/3083c722c0c738cad0f468383167a0d246f91af2bfa373e9c5c094fb8c8413e0.png", "previewfilepath": "/media/ap/3083c722c0c738cad0f468383167a0d246f91af2bfa373e9c5c094fb8c8413e0.png", "type": "texture", "channel": 1, "sampler": {"filter": "mipmap", "wrap": "repeat", "vflip": "false", "srgb": "false", "internal": "byte"}, "published": 1}], "outputs": [], "code": "\nvec3 texCol(vec2 p, float b)\n{\n    vec3 col = texture(iChannel0, p, b).xyz; //b selects mip level\n    col *= (col.x+col.y+col.z)/3.0; //gamma\n    return col;\n}\n\nvec2 perlin(vec2 p)\n{\n    vec2 x = vec2(0.0);\n    for (int i = 0; i < 6; ++i)\n    {\n        float j = pow(2.0, float(i));\n        x += (texture(iChannel1, p * j * 0.001).xy-0.5) / j;\n    }\n    return x;\n}\n\n//p = uv, o = random offset for per-pixel noise variation, t = time\nvec3 smoke(vec2 p, vec2 o, float t)\n{\n    const int steps = 10;\n    vec3 col = vec3(0.0);\n    for (int i = 1; i < steps; ++i)\n    {\n        //step along a random path that grows in size with time\n        p += perlin(p + o) * t * 0.01 / float(i);\n        p.y -= t * 0.003; //drift upwards\n        \n        //sample colour at each point, using mipmaps for blur\n        col += texCol(p, float(steps-i) * t * 0.2);\n    }\n    return col.xyz / float(steps);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    float t = fract(iTime / 3.0) * 6.0;\n    t = max(0.0, t - uv.x - 1.0 + uv.y); //start from top left\n    t *= t; //start slow and get faster\n\tfragColor = vec4(smoke(uv, fragCoord.xy/2.0, t), 1.0);\n}", "name": "", "description": "", "type": "image"}]}