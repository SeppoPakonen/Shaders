{"ver": "0.1", "info": {"id": "tsKczy", "date": "1603182551", "viewed": 20, "name": "Black-body Gradient", "username": "cjhoward", "description": "Black-body color temperature gradient", "likes": 1, "published": 1, "flags": 0, "tags": ["body"], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "/*\n * MIT License\n * \n * Copyright (c) 2020 Christopher J. Howard\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/// Transforms colors from CIE XYZ to linear RGB\nconst mat3 xyz_to_rgb = mat3\n(\n\t3.2404542, -0.9692660, 0.0556434,\n\t-1.5371385, 1.8760108, -0.2040259,\n\t-0.4985314, 0.0415560, 1.0572252\n);\n\n/**\n * Calculates the color of an ideal black-body radiator, given its temperature in Kelvin.\n *\n * @param t Temperature, in Kelvin.\n * @return Correlated color, in linear RGB space.\n *\n * @see https://en.wikipedia.org/wiki/Planckian_locus\n * @see https://en.wikipedia.org/wiki/CIE_1960_color_space\n * @see https://google.github.io/filament/Filament.html\n */\nvec3 blackbody(float t)\n{\n\t// Approximate the Planckian locus in CIE 1960 UCS color space (Krystek's algorithm)\n\tfloat tt = t * t;\n    float u = (0.860117757 + 1.54118254e-4 * t + 1.28641212e-7 * tt) / (1.0 + 8.42420235e-4 * t + 7.08145163e-7 * tt);\n    float v = (0.317398726 + 4.22806245e-5 * t + 4.20481691e-8 * tt) / (1.0 - 2.89741816e-5 * t + 1.61456053e-7 * tt);\n\t\n\t// CIE 1960 UCS -> CIE xyY, Y = 1\n    vec2 xyy = vec2(3.0 * u, 2.0 * v) / (2.0 * u - 8.0 * v + 4.0);\n\t\n\t// CIE xyY -> CIE XYZ\n\tvec3 xyz = vec3(xyy.x / xyy.y, 1.0, (1.0 - xyy.x - xyy.y) / xyy.y);\n    \n\t// CIE XYZ -> linear RGB\n    vec3 rgb = xyz_to_rgb * xyz;\n    \n    // Normalize RGB to preserve chromaticity\n\treturn rgb / max(rgb.x, max(rgb.y, rgb.z));\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    // Lerp temperature from 1,000-12,000 Kelvin\n    float t = mix(1000.0, 12000.0, fragCoord.x / iResolution.x);\n    \n    // Calculate correlated linear RGB color at temperature\n    vec3 color = blackbody(t);\n    \n    // Gamma correct\n    fragColor = vec4(pow(color, vec3(1.0 / 2.2)), 1.0);\n}\n", "name": "Image", "description": "", "type": "image"}]}