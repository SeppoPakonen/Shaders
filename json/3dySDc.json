{"ver": "0.1", "info": {"id": "3dySDc", "date": "1575119326", "viewed": 227, "name": "Study Ray Marching", "username": "familyshadertoy000", "description": "\u5b66\u4e601", "likes": 1, "published": 3, "flags": 0, "tags": ["study"], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "// \u5c4f\u5e55\u5de6\u4e0b\u89d2UV(0,0) \u53f3\u4e0a\u89d2UV(1,1) \n// \u4e09\u7ef4\u5750\u6807\uff1a\u5de6\u624b\u5750\u6807\u7cfb,X\u8f74\u6307\u5411\u5c4f\u5e55\u53f3\u4fa7\uff0cY\u8f74\u6307\u5411\u5c4f\u5e55\u4e0a\u9762\uff0cZ\u8f74\u5782\u76f4\u4e8e\u5c4f\u5e55\u5411\u91cc\n\n// \u6700\u5927\u6b65\u6570\n// \u6700\u5927\u8ddd\u79bb\n// \u6700\u5c0f\u6b65\u8fdb\u7684\u8ddd\u79bb\n#define Max_Steps 100\n#define Max_Dist 100.\n#define Surf_Dist 0.01\n\n// \nfloat GetDist(vec3 p)\n{\n    vec4 s = vec4(0,1,6,1);// \u7403\u7684\u4f4d\u7f6e(s.xyz)\u548c\u534a\u5f84\uff08s.w\uff09\n    float sphereDist = length(p-s.xyz)-s.w;// P\u70b9\u5230\u7403\u9762\u7684\u8ddd\u79bb\n    float planeDist  = p.y;// P\u70b9\u5230\u5e73\u9762\u7684\u8ddd\u79bb\n    \n    float d = min(sphereDist,planeDist);\n    return d;\n}\n\n// \nfloat RayMarch(vec3 ro, vec3 rd)\n{\n    float d0 = 0.;\n    for(int i = 0; i < Max_Steps; i++)\n    {\n        vec3 p = ro + rd*d0;\n        float ds = GetDist(p);\n        d0+=ds;\n        if(d0>Max_Dist || ds < Surf_Dist) \n            break;           \n    }\n                     \n    return d0;     \n}\n\n// \u9876\u70b9\u7684\u6cd5\u7ebf\nvec3 GetNormal(vec3 p)\n{\n    float d = GetDist(p);\n    vec2 e = vec2(0.01,0);\n    \n    vec3 n = d-vec3(\n        GetDist(p-e.xyy),\n        GetDist(p-e.yxy),\n        GetDist(p-e.yyx));\n    return normalize(n);\n}\n\n// \u8ba1\u7b97\u706f\u5149\uff0c\u70b9\u5149\u6e90\nfloat GetLight(vec3 p)\n{\n    vec3 lightPos = vec3(0,5,6);\n    lightPos.xz += vec2(sin(iTime),cos(iTime))*2.0;\n    vec3 l = normalize(lightPos-p);\n    vec3 n = GetNormal(p);\n    \n    float dif = clamp(dot(n,l),0.,1.);\n    \n    float d = RayMarch(p + n*Surf_Dist*2.0,l);\n    if(d<length(lightPos-p))dif*=0.1;\n    return dif;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord-0.5*iResolution.xy)/iResolution.y;\n    vec3 col = vec3(0);\n    \n    // Camera\uff1aro \u4f4d\u7f6e\uff0c rd \u65b9\u5411\n    vec3 ro = vec3(0,1,0);\n    vec3 rd = normalize(vec3(uv.x,uv.y,1.));\n    \n    float d = RayMarch(ro,rd);\n    \n    vec3 p = ro + rd*d;\n    \n    float dif = GetLight(p);\n    \n    \n    //d/=6.0;\n    col = vec3(dif);\n\n    // Output to screen\n    fragColor = vec4(col,1.0);\n}", "name": "Image", "description": "", "type": "image"}]}