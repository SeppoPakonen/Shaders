{"ver":"0.1","info":{"id":"NdlGRN","date":"1615667050","viewed":23,"name":"Interleave sampling","username":"clem494949","description":"I'm trying to implement the interleave sampling from this paper: \"Global Illumination Optimization: Integrating Interleaved Sampling into\nReflective Shadow Maps and Splatting Indirect Illumination.\"","likes":0,"published":1,"flags":32,"usePreview":0,"tags":[]},"renderpass":[{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define ANIMATE 1\n#define SECOND_STEP 1\n// Second step: reorder the areas\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec2 quad = step(0.5, uv);\n    vec2 subquad = step(0.5, fract(uv*2.0));\n    #ifdef ANIMATE\n    if(mod(iTime, 6.0) > 4.0) {\n    #endif\n    #ifdef SECOND_STEP\n    uv = mod(uv, 0.25);\n    // set the quadrant to the subquadrant index\n    uv += 0.5*subquad;\n    // set the subquadrant to the quadrant index\n    uv += 0.25*quad;\n    #endif\n    #ifdef ANIMATE\n    }\n    #endif\n    vec3 col = texture(iChannel0, uv).rgb;\n    fragColor = vec4(col.rgb,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"// Generate a testing texture\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec3 col = vec3(0.0);\n    // Colors to make sure the right pixel is sample\n    col.r = floor(mod(fragCoord.x, 2.0));\n    col.g = floor(mod(fragCoord.y, 2.0));\n    // Repeating pattern to make sure the image is reconstructed\n    col.b = mod(length(fragCoord-iResolution.xy/2.0)/iResolution.x*8.8, 1.0);\n    fragColor = vec4(col, 1.0);\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"#define ANIMATE 1\n#define FIRST_STEP 1\n// First step: process interleavr sampling in each quadrant\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec2 quad = step(0.5, uv);\n    vec2 subquad = step(0.5, fract(uv*2.0));\n    // I don't know how to make it works with a screen res non-multiple of 4\n    // This fixes it partially\n    vec2 resNotMultipleOf4 = fract(iResolution.xy/4.0)*2.0;\n    vec2 fixedRes = iResolution.xy - 2.0*resNotMultipleOf4;\n    vec2 halfScreen = 0.5*fixedRes/iResolution.xy;\n    \n    #ifdef ANIMATE\n    if(mod(iTime, 6.0) > 2.0) {\n    #endif\n    #ifdef FIRST_STEP\n    // Zoom in\n    uv = floor(fragCoord)*2.0/iResolution.xy;\n    // One pixel offset depending on the subquadrant\n    uv += subquad/iResolution.xy;\n    // Texture sampling offset\n    uv += halfScreen/iResolution.xy;\n    // Repeat image\n    uv = mod(uv, halfScreen);\n    // Sample from the corresponding quadrant\n    uv += halfScreen*quad;\n    #endif\n    #ifdef ANIMATE\n    }\n    #endif\n\n    vec3 col = texture(iChannel0, uv).rgb;\n    fragColor = vec4(col.rgb,1.0);\n    //fragColor = vec4(floor(mod(uv*iResolution.xy,2.0)).xyy,1.0);\n    //fragColor = vec4(floor(mod(uv*fixedRes,2.0)).xyy,1.0);\n    //fragColor = vec4(uv.xyy,1.0);\n}","name":"Buffer B","description":"","type":"buffer"}]}