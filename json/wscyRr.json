{"ver":"0.1","info":{"id":"wscyRr","date":"1600253973","viewed":48,"name":"micelio #1","username":"lechuga","description":"follow the white rabbit","likes":5,"published":1,"flags":0,"tags":[]},"renderpass":[{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define pi acos(-1.)\n#define tn +(texture(iChannel0, p1.xz).x * (0.025))\n\n\n#define mot time*10.5\n#define time mod(iTime, 100.)\nfloat smin(float a, float b, float k){\n  float h = max(k-abs(a-b), 0.) / k;\n  return min(a,b)-h*h*h*k*(1.0 / 6.0);\n}\n\nfloat smin(float a, float b, float k, float e){\n  float h = max(k-abs(a-b), 0.) / k;\n  return min(a,b)-h*h*h*k*(1.0 / e);\n}\n\nmat2 rot(float a){\n  float aco = cos(a);\n  float asi = sin(a);\n  \n  return mat2(aco, asi, -asi, aco);\n}\n\nvoid tunnel(inout vec3 p){\n  p.x += sin(p.z*.65)*.35;\n  p.y += sin(p.z*.985)*.65;\n}\n\nvoid tunnel2(inout vec3 p){\n  p.z += sin(p.y*.55+time*14.9)*.25+.5;\n  p.x += sin(p.y*.3+time*3.5)*.55+.5;\n}\n\nvoid tunnel2(inout float a){\n  a += sin(a*.55+time*4.9)*.25+.5;\n  a += sin(a*.3+time*3.5)*.55+.5;\n}\n\nvec2 rep(vec2 p, vec2 s){\n  return (fract(p/s-.5)-.5)*s;\n}\n\nfloat rep(float p, float s){\n  return (fract(p/s-.5)-.5)*s;\n}\n\nfloat toro(vec2 p, float a, float r1, float r2){\n  return length(1.-vec2(length(p)-r1, a) )-r2;\n}\n\nfloat box(vec3 p, vec3 s){\n  vec3 q = abs(p)-s;\n  return max(q.x , max(q.z, q.y));\n}\n\nfloat cil(vec2 p, float r){\n  return length(p)-r;\n}\n\nfloat esf(vec3 p, float r){\n  return length(p)-r;\n}\n\nfloat dBg;\nfloat bg(vec3 p, float l){\n  vec3 p1 = p;\n  tunnel2(p1);\n  l += sin(p1.y)*.5 tn;\n  float d = p1.y - l;\n  dBg = d;\n  return d;\n}\n\n//\n\nfloat rand(float a){\n  return fract(sin(a*32984.283748)*98239.3485734);\n}\nfloat rand21(vec2 uv){\n  return fract(dot(sin(uv*56.345+uv.yx*.345345)*345.345435,vec2(-123.0123213, 4.43598345)));\n}\n\nvoid fractalVulvo(inout vec3 p, in float iter){\n  float pp = .36;\n  \n  for(float i = 0.; i < iter; i++){\n    p.x = abs(p.x)-pp;\n    p.z = abs(p.z)-pp;\n  }\n}\n\nvoid anim(inout float a){\n  a += sin(a)*sin(time)*.25;\n}\n\nfloat conejo(vec3 p, float r){\n  // TEST ROT\n  p.xz *= rot(1.6);\n  float d = 1.;\n  const float sv = .5;\n  \n  //p.xy *= rot(sin(time*10.)*.25);\n  p.z += sin(p.x*.25+time*2.)*1.6;\n  p.y -= sin(p.x*.50+time*5.)*1.5;\n  \n  \n  //orejas\n  vec3 porejas = p;\n  porejas.x -= 1.3;\n  porejas.z = abs(porejas.z)-.125;\n  float orejas = cil(porejas.xz, r*.08);\n  \n  orejas = max(orejas, -porejas.y+.225);\n  orejas = max(orejas, porejas.x);\n  orejas = max(orejas, porejas.y-1.25);\n  vec3 porificios = p;\n  porificios.y -= 1.45;\n  porificios.x -= 1.3;\n  porificios.z = abs(porificios.z)-.1;\n  float orificios = esf(porificios, .0001);\n  orejas = smin(orejas, orificios, 0.7);\n  d = smin(d, orejas, sv);\n  //cabeza\n  vec3 pcabeza = p;\n  pcabeza.y += .25;\n  pcabeza.x -= 1.25;\n  float rcabeza =  r*.4;\n  float cabeza = esf(pcabeza,rcabeza);\n  d = smin(d, cabeza, sv);\n  \n  //ojos\n  vec3 pojos = p;\n  pojos.y += .2;\n  pojos.x -= 1.55;\n  pojos.z = abs(pojos.z)-rcabeza+.1;\n  float ojos = esf(pojos, r*.035);\n  d = min(d, ojos);\n  \n  //cuerpo\n  float cuerpo =  esf(p, r*.85);\n  d = smin(d, cuerpo, sv);\n  //patas\n  vec3 ppatas = p;\n  ppatas.y += 1.05;\n  \n  float absm = .44;\n  anim(absm);\n  ppatas.x = abs(ppatas.x)-absm;\n  \n  ppatas.z = abs(ppatas.z)-.25;\n  float rpatas = r*.15;\n  float patas = esf(ppatas, rpatas);\n  d = smin(d, patas, sv);\n  //cola\n  vec3 pcola = p;\n  pcola.y -= .5;\n  pcola.x += 1.;\n  \n  vec3 p1 = p;\n  float rcola = r*.15 tn * .4;\n  float cola = esf(pcola, rcola);\n  d = smin(d, cola, sv);\n  \n  \n  return d;\n}\nfloat dVulvo;\nvoid vulvos(in vec3 p, in float id, in float rs, inout float sombrero){\n  vec3 p3 = p;\n  float vulvo;\n  for(float i = 0.; i < 5.; i++){\n    p3 = p;\n    p3.xz *= rot(pi*id+i);\n    p3.y -= rs+.3+(i*.1);\n    fractalVulvo(p3, 2.);\n    \n    // vulvo\n    vulvo = esf(p3, .1);\n    dVulvo+= .1/(1.+vulvo*vulvo);\n    sombrero = min(vulvo, sombrero);\n    \n  }\n    p3 = p;\n    p3.z -= id;\n    p3.y -= rs+1.05;\n    // vulvo 2\n    float vulvo2 = esf(p3, -id);\n    sombrero = smin(vulvo2, sombrero, .9);\n}\n\nfloat dTallo;\n\nfloat dSombrero;\n// AMANITA MUSCARIA\nfloat amanita(vec3 p, float r){\n  \n  vec2 sp = vec2(20, 5);\n  \n  vec2 gid = floor(p.xz/sp-.5);\n  {//if(mod(gid.x, 4) != (0)){\n    float id = rand21(gid);\n\n    tunnel2(p);\n    p.x = abs(p.x)-10.;\n    p.xz = rep(p.xz, sp); \n    \n    vec3 p1 = p;\n    vec3 p2 = p;\n\n    tunnel(p1);\n    float rs = r tn tn tn;\n    float sombrero = esf(p1, rs+1.);\n    sombrero = max(sombrero, -p1.y);\n    dSombrero = .05/ (sombrero*sombrero);\n    \n    vulvos(p1, id, rs, sombrero);\n    \n    // tallo\n    tunnel(p2);\n    float tallo = cil(p2.xz, r tn tn);\n    tallo = max(tallo, p2.y);\n    dTallo = .5/(.22+tallo*tallo);\n    \n    return min(sombrero, tallo);\n  }\n}\nfloat idTree;\nfloat dTrees = 1.;\nfloat trees(vec3 p){\n  vec2 sp = vec2(20, 5.5);\n  vec3 p1 = p;\n  \n  \n  vec2 gid = floor(p1.xz/sp-.5);\n  float id = rand21(gid);\n \n  vec3 pid = p1;\n  pid.xz -= id;\n  tunnel2(pid);\n  p1 = pid;\n  //p1.xz += id+time;\n  {//if(mod(gid, 2) == vec2(0)){\n    \n    idTree = id;\n    p1.xz = rep(p1.xz, sp);\n    \n    p1.z = abs(p1.z)-.4;\n    \n    p1.x = abs(p1.x)-6.;\n    \n  \n    {//for(int i = 0;i < 1.; i++){\n      p1.xz *= rot(p1.y*.55);\n      p1.x = abs(p1.x);\n      p1.z = abs(p1.z);\n      p1.x -= .15;\n      p1.z -= .1;\n      \n    }\n    \n    float tree = cil(p1.xz, .5-sin(time*.5)*.25+.5 - id tn tn tn);\n    //dTrees *= .12/(1+tree*tree);\n    return tree;\n  }\n  return 1.;\n}\n\nfloat map(vec3 p){\n  //return conejo(p, 1.);\n  vec3 p1 = p;\n  p1.x = abs(p1.x)-1.;\n  p1.xy *= rot(.5);\n  // conejo\n  vec3 p2 = p;\n  p2.z -= 9.;\n  p2.z -= mot;\n  float c = conejo(p2, 1.2);\n  float d = c;\n  \n  \n  float r1 = 0.5;\n  float ama = amanita(p1, r1);\n  \n  float bgr = bg(p, -2.);\n  float trs = trees(p1);\n  \n  d = min(d, min(ama, trs));\n  d = smin(bgr, d, 1.1);\n  \n  \n  \n  return d;\n}\n\nvec3 norm(vec3 p){\n  vec2 offs = vec2(.01, 0.);\n  return normalize(map(p) - vec3(map(p-offs.xyy), map(p-offs.yxy), map(p-offs.yyx)));\n}\n\nvoid camMotion(inout vec3 c){\n  \n  c.z += mot;\n  tunnel(c);\n}\n\n#define red vec3(1.,-1., -1.)\n#define white vec3(1.)\n#define blue vec3(.0, .15, 1.)\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord/iResolution.xy;\n\tuv -= 0.5;\n\tuv /= vec2(iResolution.y / iResolution.x, 1.);\n  \n  \n  vec3 col = vec3(0);\n  \n  vec3 s = vec3(0., 5., -6);\n  vec3 t = vec3(0., 3., 0);\n  \n  camMotion(s);\n  camMotion(t);\n  \n  \n  vec3 cz = normalize(t - s);\n  vec3 cx = normalize(cross(cz, vec3(0., -1. ,0.)));\n  vec3 cy = normalize(cross(cz, cx));\n  \n  float fov = .5;\n  vec3 r = normalize(cx * uv.x + cy * uv.y + cz * fov);\n  \n  vec3 lp = s;\n  \n  \n  \n  vec3 p = s;\n  for(int i = 0; i < 100; i++){\n    float d = map(p);\n    if(abs(d) < 0.01 || d > 100.){\n      break;\n    }\n    \n    \n    p+=d*r;\n  }\n  \n  vec3 n = norm(p);\n  //float ao = 1-max(map(p-lp/n)*.25,0.);\n  \n  float fog = 1.-clamp(length(p-s)/45., 0., 1.);\n    \n    float F = max(0. , min(1., .5+.5*pow(dot(r, n), 6.)));// fresnel\n  \n    vec3 lr = normalize(lp-p);\n \n  \n  //lr.z -= mot;\n  \n    vec3 dif = vec3(max(0., min(1., dot(lr, n))));\n  \n    \n    col = dif;\n    col *= mix(col , white , F);\n    //col = mix(col, vec3(ao), vec3(0.1, .01, .5));\n  \n  // amanita\n  col *= 1.-dSombrero * red*.004;\n  \n  // tallo\n  //col += dTallo * white*.05;\n  col -= 1.-dVulvo * dif * .5;\n  \n \n  //col *= F;\n  \n  \n  col += 1.-exp(col)/dif*.4;\n  col += length(uv);\n  col *= fog;\n  \n\tfragColor = vec4(col, 1.);\n}","name":"Image","description":"","type":"image"}]}