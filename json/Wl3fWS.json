{"ver": "0.1", "info": {"id": "Wl3fWS", "date": "1613320717", "viewed": 89, "name": "Happy Chinese New Year ", "username": "Learner_CC", "description": "Learn from olympus223\u2019s Fireworks night, and make some adjustment.\nAt last, happy Chinese new year. ", "likes": 3, "published": 1, "flags": 0, "usePreview": 0, "tags": [], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "#define s(a, b, t) smoothstep(a, b, t)\n#define g -9.81\n\n// -------- \u968f\u673a\u6570 -------- //\nfloat N21(vec2 p) {\n\tp = fract(p * vec2(233.34, 851.73));\n    p += dot(p, p + 23.45);\n    return fract(p.x * p.y);\n}\n\nvec2 N22(vec2 p) {\n\tfloat n = N21(p);\n    return vec2(n, N21(p + n));\n}\n\nfloat N11(float n) {\n    return fract(sin(dot(vec2(cos(n), sin(n)) ,vec2(27.9898, 38.233))) * 88.5453);\n}\n\n// -------- \u70df\u82b1\u76f8\u5173\u7684\u4e09\u4e2a\u51fd\u6570 -------- //\nvec2 p1(vec2 p, float h, float t) {\n    // \u8fd4\u56de\u70df\u82b1\u7efd\u653e\u524d\u7684\u9ad8\u5ea6\n    // p \u70df\u82b1\u521d\u59cb\u4f4d\u7f6e\n    // h \u4e0a\u5347\u7684\u9ad8\u5ea6\n    // t \u65f6\u95f4\n    return vec2(p.x, p.y + clamp(pow(t, 5.0), 0.0, h));\n}\nvec2 p2(vec2 p, float h, float t) {\n    // \u4e0a\u5347\u4e2d\u70df\u82b1\u5c3e\u90e8\u7684\u4f4d\u7f6e\n    return vec2(p.x, p.y + clamp(pow(0.95 * t, 5.0), 0.0, h));\n}\nfloat endTime(float h) {\n    // \u8ba1\u7b97\u70df\u82b1\u7efd\u653e\u7684\u65f6\u95f4\n    return pow(h, 1.0 / 5.0) * 1.1;\n}\nfloat seed = 0.0;\nfloat particle(vec2 uv, vec2 p, vec2 v, float r, float t) {\n    float x = p.x + v.x * t;\n    float y = p.y + v.y * t + g / 2.0 * t * t;\n    vec2 j = (vec2(x, y) - uv) * 20.0;\n    float sparkle = 1.0 / dot(j, j);\n    return sparkle;\n}\nfloat explosion(vec2 uv, vec2 p, float s, float n, float t) {  \n    // n \u751f\u6210\u7c92\u5b50\u7684\u4e2a\u6570\n    // t \u70df\u82b1\u51fa\u73b0\u7684\u65f6\u95f4\n    float m = 0.0;\n    float dt = 0.5;\n    // \u901a\u8fc7\u5faa\u73af\u5206\u51fa\u7c92\u5b50\n    for(float i = 0.0; i < n; i++) {\n        seed += i;\n        vec2 rand = vec2(1.0, 1.8) * (vec2(-1.0, 1.0) + 2.0 * N22(vec2(seed, i)));\n        vec2 v = vec2(cos(seed), sin(seed)) + rand;\n        // \u7b2c\u4e00\u4e2as\u63a7\u5236\u70df\u82b1\u7c92\u5b50\u51fa\u73b0\u65f6\u673a\n        // \u7b2c\u4e8c\u4e2as\u63a7\u5236\u70df\u82b1\u7c92\u5b50\u6d88\u5931\u7684\u65f6\u673a\n        m += particle(uv, p, v, s, t)\n            * s(0.0, dt, t)\n            * s(1.0, 1.0 - dt, t);\n    }\n    return m;\n}\n\nfloat fireworks(vec2 uv, vec2 p, float h, float n, float s, float t) {\n    vec2 p1 = p1(p, h, t);\n    float e = endTime(h);\n    return explosion(uv, p1, s, n, t - e * 0.9);\n}\n\nfloat distLine(vec2 p, vec2 a, vec2 b) {\n\tvec2 pa = p - a;\n    vec2 ba = b - a;\n    float t = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);\n    return length(pa - ba * t);\n}\n\nfloat line(vec2 uv, vec2 a, vec2 b, float w) {\n    return w / distLine(uv, a, b);\n}\n\nfloat shaft(vec2 uv, vec2 p, float w, float h, float t) {\n    vec2 head = p1(p, h, t) + vec2(0.0, 0.3);\n    vec2 tail = p2(p, h, t);\n    float e = 1.0 / 0.95 * endTime(h);\n    vec2 j = (head - uv) * 15.0;\n    float sparkle = 1.0 / dot(j, j);\n    return (line(uv, head, tail, w) + sparkle) * s(e, e - 0.5, t) * 0.5;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    vec2 uv = gl_FragCoord.xy / iResolution.xy;\n    float pct = 0.0;\n\n    vec2 st = uv - 0.5;\n    float t = iTime / 10.0;\n    float scale = 10.0;\n    \n    st *= scale;\n    \n    vec3 color = mix(vec3(0.1515, 0.2375, 0.5757), vec3(0.0546, 0.0898, 0.1953), uv.y);\n    \n    for (float i = 0.0; i < 1.0; i += 0.125) {\n        float ti = mod(t * 9.0 - i * 5.0, 4.0);\n        float scale = mix(2.0, 0.3, ti / 4.0);\n        vec2 uvs = st * scale;\n        float rand = N11(i);\n        float h = 10.0 + rand * 4.0;\n        float w = 0.02;\n        float n = 80.0;\n        float s = 0.9;\n        vec2 p = vec2(mix(-8.0, 8.0, rand), -10.0);\n\n        pct += fireworks(uvs, p, h, n, s, ti) + shaft(uvs, p, w, h, ti);\n        vec3 sparkColor = vec3(0.0);\n        rand = N11(rand);\n        sparkColor.x = rand;\n        rand = N11(rand);\n        sparkColor.y = rand;\n        rand = N11(rand);\n        sparkColor.z = rand;\n\n        color += fireworks(uvs, p, h, n, s, ti) * sparkColor + shaft(uvs, p, w, h, ti);\n    }\n    fragColor = vec4(color, 1.0);\n}", "name": "Image", "description": "", "type": "image"}]}