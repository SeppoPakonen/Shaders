{"ver": "0.1", "info": {"id": "7tc3zN", "date": "1635877381", "viewed": 113, "name": "Draft Quadtree [learning]", "username": "byt3_m3chanic", "description": "Needed to sit down and figure out a good way to make a quadtree for 2D / Tiling - of course @Shane has plenty to study and poke around. \nAnd yes it needs some AA - havent figured the scaling for smoother smaller quads.. ", "likes": 11, "published": 3, "flags": 0, "usePreview": 0, "tags": [], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "/**\n    License: Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License\n\n    Draft Quadtree [learning]\n    11/2/21 @byt3_m3chanic\n\n    Trying to learn multiscale truchet / but I need to master\n    quadtrees first - I made one attempt that was pretty crude\n    and brute force - https://www.shadertoy.com/view/fl33zn\n    \n    it's not right and has issues - so going back and looking\n    into some examples by @Shane which is the basis of this shader.\n    @Shane https://www.shadertoy.com/view/llcBD7\n\n    Done in an attempt to learn the basics and how to use\n    and match up ID's with spaces. \n \n*/\n\n#define R          iResolution\n#define M          iMouse\n#define T          iTime\n#define PI         3.14159265359\n#define PI2        6.28318530718\n\nmat2 rot (float a) { return mat2(cos(a),sin(a),-sin(a),cos(a)); }\nfloat hash21(vec2 p){ return fract(sin(dot(p,vec2(26.34,45.32)))*4324.23); }\n\nvec3 hue(float t){ \n    t*=5.;//tweak for other color variations\n    const vec3 d = vec3(0.067,0.812,0.910);\n    return .35 + .45*cos(PI2*t*(vec3(.95,.97,.98)*d)); \n}\n\nfloat box( in vec2 p, in vec2 b ){\n    vec2 d = abs(p)-b;\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\n\nfloat px = .0231;\n\n\nfloat doHatch(vec2 p, float res) {\n    p *= res/10.;\n    vec2 id = floor(p*.5)-.5;\n    float rnd = hash21(floor(p*.5));\n    float chk = mod(id.y + id.x,2.) * 2. - 1.;\n    if (chk > 0.5) p.x *=-1.;\n    float hatch = clamp(sin((p.x - p.y)*PI*3.)*3. + 0.25, 0., 1.);\n    if(rnd>.66) hatch = rnd;\n    return clamp(hatch,.3,.7);\n}\n\nvoid mainImage( out vec4 O, in vec2 F ) {\n\n    vec2 uv = (2.*F.xy-R.xy)/max(R.x,R.y);\n       \n    vec2 vuv= uv*(3.+.45*sin(T*.135));\n    vuv.xy*=rot(.5*sin(T*.2));\n\n    vuv.y+=T*.35;\n    float px = fwidth(uv.x);\n    float level=1.;\n\n    vec3 C = vec3(.25*.25)*doHatch(vuv,155.);\n    px = fwidth(uv.x)*2.;\n    for(int k=0; k<5; k++){\n        vec2 id = floor(vuv*level);\n        float rnd = hash21(id);\n        \n        // threshold or if last loop\n        if(rnd>.45||k>3) {\n            \n \n            vec2 p = vuv -(id+.5)/level;\n            rnd = hash21(rnd+id.yx);\n            float dir = rnd>.5 ?-1.:1.;\n\n            // make ring parts - very basic\n            float angle = atan(p.x, p.y);\n            float f = length(p);\n            float width = .5/level;\n            float amt = 6.;\n            //vec for moving ring\n            vec2 q = vec2(\n                fract(dir*amt*angle/PI+T*1.75)/level,\n                f-width\n            );\n            //id for moving ring\n            vec2 tid = vec2(\n                floor(dir*amt*angle/PI+T*1.75),\n                floor(f-width)\n            );\n            \n            tid.x=mod(tid.x,amt);\n            \n            float d = length(p)-.465/level;\n            float s = length(p)-.325/level;\n            float c = box(q+vec2(0,.5/level),vec2(1.,.25)/level);\n            float l = length(p)-.155/level;\n            float h = abs(l)-.014/level;\n            \n            d = smoothstep(px,-px,d);\n            s = smoothstep(px,-px,s);\n            c = smoothstep(px,-px,c);\n            l = smoothstep(px,-px,l);\n            h = smoothstep(px,-px,h);\n            \n            C=mix(C,vec3(.4*.4),d);\n            C=mix(C,vec3(.18*.18),min(s,d));\n            c=min(c,s);\n            C=mix(C,hue(hash21(tid)),min(c,d));\n            C=mix(C,vec3(.05*.05),min(l,d));\n            C=mix(C,vec3(.185*.185),h);\n            \n            break;\n        }\n        level*=2.;\n    }\n    \n    C = pow(C, vec3(.4545));        \n    O = vec4(C,1.0);\n}\n\n", "name": "Image", "description": "", "type": "image"}]}