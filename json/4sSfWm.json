{"ver": "0.1", "info": {"id": "4ssfWM", "date": "1496429062", "viewed": 406, "name": "analytical bayer matrix dither", "username": "Jodie", "description": "calculating bayer matrices with math", "likes": 8, "published": 1, "flags": 0, "tags": ["prism", "dispers", "hand"], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "/*\n0 2\n3 1\n\n00->00\n01->11\n10->10\n11->01\n\n*/\n\nuint bitfieldReverse(uint x){\n    x = ((x >> 1u) & 0x55555555u) | ((x & 0x55555555u) << 1u);\n    x = ((x >> 2u) & 0x33333333u) | ((x & 0x33333333u) << 2u);\n    x = ((x >> 4u) & 0x0f0f0f0fu) | ((x & 0x0f0f0f0fu) << 4u);\n    x = ((x >> 8u) & 0x00ff00ffu) | ((x & 0x00ff00ffu) << 8u);\n    x = ((x >> 16u) & 0xffffu) | ((x & 0xffffu) << 16u);\n    return x;\n}\n\nuint bitfieldInterleave(uint x,uint y){\n\n    x = (x | (x << 8u)) & 0x00FF00FFu;\n    x = (x | (x << 4u)) & 0x0F0F0F0Fu;\n    x = (x | (x << 2u)) & 0x33333333u;\n    x = (x | (x << 1u)) & 0x55555555u;\n\n    y = (y | (y << 8u)) & 0x00FF00FFu;\n    y = (y | (y << 4u)) & 0x0F0F0F0Fu;\n    y = (y | (y << 2u)) & 0x33333333u;\n    y = (y | (y << 1u)) & 0x55555555u;\n\n    return x | (y << 1u);\n}\n\nuint bitfieldInterleaveReverse(uint x,uint y){\n\t\n    x = ((x>>8u) | (x << 16u)) & 0x00FF00FFu;\n    x = ((x>>4u) | (x <<  8u)) & 0x0F0F0F0Fu;\n    x = ((x>>2u) | (x <<  4u)) & 0x33333333u;\n    x = ((x>>1u) | (x <<  2u)) & 0x55555555u;\n\n    y = ((y>>8u) | (y << 16u)) & 0x00FF00FFu;\n    y = ((y>>4u) | (y <<  8u)) & 0x0F0F0F0Fu;\n    y = ((y>>2u) | (y <<  4u)) & 0x33333333u;\n    y = ((y>>1u) | (y <<  2u)) & 0x55555555u;\n\n    return y | (x << 1u);\n}\n\nuint bitfieldInterleaveReverse16(uint x,uint y){\n\n    x = (x | (x << 12u)) & 0xF0F0u;\n    x = (x | (x >>  6u)) & 0x3333u;\n    x = (x | (x <<  3u)) & 0xaaaau;\n    \n    y = (y | (y << 12u)) & 0xF0F0u;\n    y = (y | (y >>  6u)) & 0x3333u;\n    y = (y | (y <<  3u)) & 0xaaaau;\n\n    return y>>1u | x;\n}\n\nfloat bayer256(vec2 fragCoord){\n    const float rcpMaxInt = 1./exp2(16.);\n    uvec2 x = uvec2(fragCoord);\n\treturn float(\n        bitfieldInterleaveReverse16(x.x^x.y, x.y)\n    ) * rcpMaxInt;\n}\n\nfloat bayerMax(vec2 fragCoord){\n    const float rcpMaxInt = 1./exp2(32.);\n    uvec2 x = uvec2(fragCoord);\n\treturn float(\n        //bitfieldReverse(\n        //    bitfieldInterleave(x.x^x.y, x.y)\n        //)\n        bitfieldInterleaveReverse(x.x^x.y, x.y)\n    ) * rcpMaxInt;\n}\n\n\n\nfloat bayer2(vec2 a){\n    uvec2 b = uvec2(a);\n    uint c = (b.x^b.y)<<1u;\n    return float(\n        (c&2u)|(b.y&1u)\n    )/4.;\n}\nfloat bayer4(vec2 a){\n    uvec2 b = uvec2(a);\n    uint c = (b.x^b.y)<<1u;\n    return float(\n        ((c&4u|b.y&2u)>>1u)|((c&2u|b.y&1u)<<2u)\n    )/4./4.;\n}\nfloat bayer8(vec2 a){\n    uvec2 b = uvec2(a);\n    uint c = (b.x^b.y)<<1u;\n    return float(\n        ((c&8u|b.y&4u)>>2u)|((c&4u|b.y&2u)<<1u)|((c&2u|b.y&1u)<<4u)\n    )/4./4./4.;\n}\nfloat bayer16(vec2 a){\n    uvec2 b = uvec2(a);\n    uint c = (b.x^b.y)<<1u;\n    return float(\n        ((c&16u|b.y&8u)>>3u)|((c&8u|b.y&4u))|((c&4u|b.y&2u)<<3u)|((c&2u|b.y&1u)<<6u)\n    )/4./4./4./4.;\n}\nfloat bayer32(vec2 a){\n    uvec2 b = uvec2(a);\n    uint c = (b.x^b.y)<<1u;\n    return float(\n        ((c&32u|b.y&16u)>>4u)|((c&16u|b.y&8u)>>1u)|((c&8u|b.y&4u)<<2u)|((c&4u|b.y&2u)<<5u)|((c&2u|b.y&1u)<<8u)\n    )/4./4./4./4./4.;\n}\n\n#define dither2(p)   (bayer2(  p)-.375      )\n#define dither4(p)   (bayer4(  p)-.46875    )\n#define dither8(p)   (bayer8(  p)-.4921875  )\n#define dither16(p)  (bayer16( p)-.498046875)\n#define dither32(p)  (bayer32( p)-.499511719)\n#define dither256(p) (bayer256(p)-.5)\n#define ditherMax(p) (bayerMax(p)-.5)\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tfragColor.rgb = vec3(uv.x);\n    \n    fragColor.rgb += ditherMax(fragCoord);\n\n    fragColor.rgb = floor(fragColor.rgb+.5);\n    \n    //fragColor.rgb = vec3(bayer4(fragCoord));\n}", "name": "Image", "description": "", "type": "image"}]}