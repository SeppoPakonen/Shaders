{"ver": "0.1", "info": {"id": "3djyWy", "date": "1587271188", "viewed": 134, "name": "Snakebird Portal Tribute", "username": "fyrn", "description": "An attempt to recreate the portal from the game \"Snakebird\"", "likes": 2, "published": 3, "flags": 0, "tags": ["portal"], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "const int numColors = 7;\nconst float threshold = 2.5;\nconst float aa_threshold = 0.1;\n\nconst vec3 colors[numColors] = vec3[numColors](\n    vec3(0.960,0.321,0.521),\n    vec3(1.000,0.572,0.321),\n    vec3(0.949,0.917,0.321),\n    vec3(0.403,1.000,0.407),\n    vec3(0.321,0.909,0.949),\n    vec3(0.376,0.627,1.000),\n    vec3(0.694,0.423,0.972)\n);\n\n#define TAU 6.283184\n\nconst float tauToColorRange = float(numColors) / TAU;\n\nfloat phi(const float r, const vec2 pos) {\n    if (pos.y >= 0.0) {\n    \treturn acos(pos.x / r);\n    }\n    return -acos(pos.x / r);\n}\n\nvec3 rainbow(const vec2 polar) {\n    // Scale\n    float x = polar.x * 4.0;\n\n    // Rotate\n  \tfloat y = polar.y + iTime;\n\n    int index = int(mod(x * 0.9 + y * tauToColorRange, float(numColors)));\n    return colors[index];\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 pos)\n{\n    // Center\n    pos -= iResolution.xy / 2.0;\n    \n    // Normalize\n    vec2 normPos = pos * 2.0 / iResolution.xy;\n    // Normalize aspect ratio\n    float aspectRatio = iResolution.x / iResolution.y;\n    normPos.x *= aspectRatio;\n\n    // Convert to polar coordinates\n    vec2 polar;\n    polar.x = length(normPos);\n    polar.y = phi(polar.x, normPos);\n\n    // vec3(x, y, radius);\n    vec3 metaballs[] = vec3[](\n        vec3(0.0, 0.0, 0.25),\n      \tvec3((aspectRatio * 1.5) - mod(iTime, aspectRatio * 3.0), cos(iTime * 2.0) * 0.8, 0.01),\n        vec3((aspectRatio * 1.5) - mod(iTime, aspectRatio * 3.0), sin(iTime * 2.0) * 0.5, 0.04)\n    );\n    \n    // Sum all metaball strengths\n\tfloat value = 0.0;\n    for (int i = 0; i < metaballs.length(); i += 1) {\n        value += metaballs[i].z / pow(distance(metaballs[i].xy, normPos), 3.0);\n    }\n    \n    // Color based on metaball strength and threshold\n    if (value > threshold) {\n    \tfragColor.xyz = rainbow(polar);\n    } else if (value > threshold - aa_threshold) {\n        float t = smoothstep(threshold, threshold - aa_threshold, value);\n    \tfragColor.xyz = mix(rainbow(polar), vec3(0.0), t);\n    } else {\n        fragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n}", "name": "Image", "description": "", "type": "image"}]}