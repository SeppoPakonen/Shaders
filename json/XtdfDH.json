{"ver": "0.1", "info": {"id": "XtdfDH", "date": "1539475493", "viewed": 306, "name": "pmod 4d-chord-extension", "username": "ollj", "description": "drag mouse to define bounds of a chord with 2 beats over time and 3 notes over frequency domain.\n\nthe domain interval count is parameter [p] of the chord function.", "likes": 0, "published": 3, "flags": 0, "tags": ["floor"], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "/*\n//self   https://www.shadertoy.com/view/XtdfDH\n\ni fialed to get the scaling right for a non-blurry-solution\n\n\n*/\n\n\n\n\n#define vec1 float\n#define pi acos(-1.)\n#define tau pi*2.\n//float tau=6.2831853071795864769252867665590057683943387987502116419;//trig definition can be better for smarter compilers.\n#define cl(a,b,c) mi(ma(a,0.),1.)//till i define this for AD\n#define sat(x) cl(x,0.,1.)\n#define dd(a)dot(a,a)\n#define u5(a)((a)*.5+.5)\n#define u2(a)((a)*2.-1.)\n\n//domain-general pmod():\n#define pMOD(d,e) d e(inout d a,d b){d c=floor((a/b)+.5);a=(fract((a/b)+.5)-.5)*b;return c;}\npMOD(vec1,pmod)pMOD(vec2,pmod)pMOD(vec3,pmod)pMOD(vec4,pmod)\n    //repetitive only for less repetitive legacy namespace support.\n\n//2d zoom\n#define ViewZoom 32.\n//divide by/aa for hairline drawing and sharp smoothstep()\n#define Aa (min(iResolution.x,iResolution.y)/ViewZoom)\n#define fra(u)(u-.5*iResolution.xy)*ViewZoom/iResolution.y//usually first function of mainImage(),not typecast.\n\n\nvec4 oldMess(vec2 u//my first attempt for this, preserved for humility\n){u=fra(u)\n ;vec2 m=fra(iMouse.xy)\n ;vec2 n=fra(iMouse.zw)\n ;n=vec2(5.)//debug override\n ;vec2 f=fract(u)\n ;vec3 c=vec3(0)\n ;vec2 l=abs(f-.5);\n ;c.x=length((u)-(m))\n ;c.y=length((u)-(n))\n ;c.z=min(l.x,l.y)\n ;m=floor(m-.5)\n ;n=floor(n-.5)  \n ;vec2 d=(m-n)/3.// 4 columns and rows in domain [m,n]\n ;vec2 v= //floor((u/2.)+.5)\n    (fract(((u-m-.5)/d)+.5)-.5)*d\n ;vec2 w=v\n     //frame for red squares as subset of blue squares\n     ;if(all(lessThan(abs(u)-abs(m)-d,m-(m+u+d*2.)*.5)))c.x=min(c.x,length(floor(w)))\n     ;v=floor(v) \n ;//vec2 d=(1./(m-n))*2.\n ;//vec2 h=fract((u)*d)/d-m\n ;//h.x=length(h+d*.5)-.3\n ;//u+=d\n ;c.z=min(c.z,length(v))\n ;c.z=smoothstep(-.1,.1,c.z)\n ;c=1.-c\n ;return vec4(c,1);}\n\n\n\n\nvec2 pModFlooredBy(vec2 u,vec2 m,vec2 n,vec2 p//uv,cornerA,cornerB,subSections\n){vec2 r=p-1.\n\n     //;n=(fract((n/2.)+.5)-.5)*2.\n     //;m=(fract((m/2.)+.5)-.5)*2.\n     //;u=(fract((u/2.)+.5)-.5)*2.\n ;u=floor(u)\n ;m=floor(m)\n ;n=floor(n)\n ;//n+=abs(m-n)*fract(1./p)\n ;m-=n\n ;u-=n\n\n ;n=(m/p)\n     \n ;//u.x*=n.x/n.y\n ;u=(fract((u/n)+.5)-.5)*n\n ;//u=u/floor(p/m)\n     \n\n ;return u;}//d is a folded uv.\n\nvoid mainImage( out vec4 o, in vec2 u\n){//o=oldMess(u);\n ;u=fra(u)\n ;vec2 m=fra(iMouse.xy)\n ;vec2 n=fra(iMouse.zw)\n ;//n=vec2(.0)//debug override\n ;vec2 f=fract(u)\n ;vec4 c=vec4(0)\n ;vec2 l=abs(fract(u-.5)-.5);\n ;c.x=length((u)-(m))\n ;c.y=length((u)-(n))\n ;vec2 r=vec2(2,4)-1.\n ;vec2 s=abs(floor(abs(m))-floor(abs(n)))\n ;//s= max(s,1./(r+1.))\n   //  ;s=floor(s)\n     \n ;s=(mod(s,r)-s)/floor(r)\n ;vec2 d=(fract((floor(u-floor(m))/s)+.5)-.5)*s\n ;d=pModFlooredBy(u,m,n,vec2(3,5))\n ;//d=abs(d)\n ;//c.w=max(d.x,d.y)\n     //;d=fract(d)\n ;c.w= //sqrt((d))//spheres seem no use, unless i can affress their center.\n     dd(abs(d))//would be good, but blur kills it\n    //max(d.x,d.y)//would be good, but scaling is off\n ;c.xy=abs(c.xy-.3)\n ;c.z=min(l.x,l.y)\n        \n ;//m=floor(m-.5)\n ;//n=floor(n-.5)  \n ;//vec2 d=(m-n)/3.// 4 columns and rows in domain [m,n]\n\n\n ;//vec2 v= //floor((u/2.)+.5)\n  //  (fract(((u-m-.5)/d)+.5)-.5)*d\n ;//vec2 w=v\n     //frame for red squares as subset of blue squares\n   //  ;if(all(lessThan(abs(u)-abs(m)-d,m-(m+u+d*2.)*.5)))c.x=min(c.x,length(floor(w)))\n  //   ;v=floor(v) \n ;//vec2 d=(1./(m-n))*2.\n ;//vec2 h=fract((u)*d)/d-m\n ;//h.x=length(h+d*.5)-.3\n ;//u+=d\n ;//c.z=min(c.z,length(v))\n ;c.w=smoothstep(-.1,.1,(c.w)-.4)\n ;c.xy=smoothstep(-.1,.1,abs(c.xy-.2))\n ;c.z=smoothstep(-.1,.1,abs(c.z-.1))\n      ;c=1.-c\n ;c.rg+=c.w\n ;//c=1.-c\n ;o = vec4(c.xyz,1)\n ;}", "name": "Image", "description": "", "type": "image"}]}