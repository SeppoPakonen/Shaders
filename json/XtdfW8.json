{"ver":"0.1","info":{"id":"XtdfW8","date":"1539416108","viewed":297,"name":"clamp to border emulation","username":"kusma","description":"This is a prototype for emulation-code of clamp to border behavior on vulkan.\n\nTODO: Mipmapping should be possible by using textureSize(sampler, textureQueryLod(sampler, uv).x) instead of the passed size. But, you know, WebGL \u00af\\_(\u30c4)_/\u00af","likes":1,"published":1,"flags":0,"tags":[]},"renderpass":[{"inputs":[{"id":"4sf3Rn","filepath":"/media/a/0a40562379b63dfb89227e6d172f39fdce9022cba76623f1054a2c83d6c0ba5d.png","previewfilepath":"/media/ap/0a40562379b63dfb89227e6d172f39fdce9022cba76623f1054a2c83d6c0ba5d.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"/* Emulate GL_CLAMP and GL_CLAMP_TO_BORDER on top of GL_CLAMP_TO_EDGE\n *\n * sampler needs to have GL_TEXTURE_WRAP_S and/or GL_TEXTURE_WRAP_T set to\n * GL_CLAMP_TO_EDGE for the emulated dimensions for this to work as expected.\n */\n\nvec4 textureBorderClamp(sampler2D sampler, vec2 uv, vec2 size, vec4 borderColor, bvec2 wrap)\n{\n#if 0\n    // UNTESTED: to support mipmapping, we should be able to do this:\n    float lod = textureQueryLod(sampler, uv).y; // OpImageQueryLod\n    vec2 size = textureSize(sampler, lod); // OpImageQuerySizeLod\n    vec4 ret = textureLod(sampler, uv, lod); // OpImageSampleExplicitLod\n#else\n    vec4 ret = texture(sampler, uv); // OpImageSampleImplicitLod\n#endif\n    vec2 limit = vec2(1.0, 0.5); // 0.5 for GL_CLAMP, 1.0 for GL_CLAMP_TO_BORDER\n\tvec2 factors = clamp(0.5 + (abs(uv - 0.5) - 0.5) * size, vec2(0.0), limit);\n    if (wrap.x)\n    \tret = mix(ret, borderColor, factors.x);\n\n    if (wrap.y)\n        ret = mix(ret, borderColor, factors.y);\n\treturn ret;\n}\n    \nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord / iResolution.xy) * 2.0 - 0.5;\n    vec4 borderColor = vec4(0.5 + 0.5 * cos(iTime), 0.5, 0.5 + 0.5 * sin(iTime), 1.0);\n\n    fragColor = textureBorderClamp(iChannel0, uv, iChannelResolution[0].xy, borderColor, bvec2(true, true));\n}","name":"Image","description":"","type":"image"}]}