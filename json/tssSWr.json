{"ver": "0.1", "info": {"id": "tssSWr", "date": "1551105387", "viewed": 239, "name": "bits to float vs dot performance", "username": "public_int_i", "description": "performance comparison for compressing multiple values into one float, uintBitsToFloat vs dot/floor", "likes": 0, "published": 3, "flags": 0, "tags": ["bits"], "requires": ["imagebuf"]}, "renderpass": [{"inputs": [], "outputs": [{"id": "4dfGRr", "channel": 0}], "code": "/*\nResults\n\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551 System/Processor       \u2551 Iterations \u2551 Float fps \u2551 Int fps \u2551 Percent Difference \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551 Win10/GTX 980          \u2551 100000     \u2551 14.6      \u2551 10.7    \u2551 float 36% > int    \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551 Android/Mali-T880 MP12 \u2551 10000      \u2551 3.3       \u2551 4.2     \u2551 int 27% > float    \u2551\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2569\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2569\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2569\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2569\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nIf anyone tries this post your results in the comments.\n*/\n\n//Toggle tests using the defines\n#define TEST_SPEEDF 10000\n//#define TEST_SPEEDI 10000\n//#define TEST_PRECISIONF 1e-3\n//#define TEST_PRECISIONI 1e-4\n\n//dot/floor based encoding, precision errors show up between 1e-2 and 1e-3\nfloat vtof(vec2 v) {\n    return dot(floor(v*8191.9999),vec2(1./8192.,1.));\n}\nvec2 ftov(float v) {\n    return vec2(fract(v)*(8192./8191.),floor(v)/8191.);\n}\n\n//uint bits based encoding, precision errors show up at 1e-4\nfloat vtoi(vec2 v) {\n    return uintBitsToFloat(uint(v.x*65535.99) | (uint(v.y*65535.99)<<16));\n}\nvec2 itov(float v) {\n    uint u = floatBitsToUint(v);\n\treturn vec2(float(u&uint(0xFFFF)),float(u>>16))/65535.;\n}\n\nvoid mainImage( out vec4 o, in vec2 u)\n{\n    vec2 uv = u/iResolution.xy;\n\n    #ifdef TEST_SPEEDF\n    for (int i = 0; i < TEST_SPEEDF; i++) uv = ftov(vtof(uv));\n    o = vec4(uv,0,1);\n    #endif\n    #ifdef TEST_SPEEDI\n    for (int i = 0; i < TEST_SPEEDI; i++) uv = itov(vtoi(uv));\n    o = vec4(uv,0,1);\n    #endif\n    \n    #ifdef TEST_PRECISIONF\n    o = vec4(dot(abs(uv-ftov(vtof(uv))),vec2(1))/TEST_PRECISIONF);\n    #endif\n    #ifdef TEST_PRECISIONI\n    o = vec4(dot(abs(uv-itov(vtoi(uv))),vec2(1))/TEST_PRECISIONI);\n    #endif\n}", "name": "Image", "description": "", "type": "image"}]}